<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HP Bar with Crits + Random Damage</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: #222;
            color: #fff;
            gap: 20px;
            margin: 0;
        }

        #enemyIcon {
            font-size: 3rem;
            transition: filter 0.2s ease;
        }

        #hp {
            font-size: 1.2rem;
        }

        /* HP bar container */
        #hpBar {
            width: 80%;
            max-width: 400px;
            min-width: 200px;
            height: 25px;
            background: #444;
            border: 2px solid #000;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        /* Fill inside HP bar */
        #hpFill {
            height: 100%;
            width: 100%;
            background: linear-gradient(to right, #e63946, #ff4);
            transition: width 0.2s ease-out;
        }

        /* Skill button */
        button {
            width: 20vw;
            height: 20vw;
            max-width: 100px;
            max-height: 100px;
            font-size: 2rem;
            border: none;
            border-radius: 50%;
            background: #4caf50;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        button:disabled {
            background: gray;
            cursor: not-allowed;
        }

        /* Cooldown bar */
        #cooldownBar {
            width: 60%;
            max-width: 300px;
            height: 15px;
            background: #444;
            border-radius: 10px;
            overflow: hidden;
        }

        #cooldownFill {
            height: 100%;
            width: 0%;
            background: #76c7c0;
            transition: width 0.1s linear;
        }

        /* Crit message inside bar */
        #critMessage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1rem;
            color: red;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
            white-space: nowrap;
        }
    </style>
</head>
<body>
<div id="enemyIcon">ðŸ‘¾</div>
<div id="hp">HP: 100</div>
<div id="hpBar">
    <div id="hpFill"></div>
    <div id="critMessage"></div>
</div>

<button id="hitBtn">ðŸ’¥</button>

<div id="cooldownBar"><div id="cooldownFill"></div></div>

<script>
    let defeated = false;
    let hp = 100;
    const maxHp = 150;
    const hpDisplay = document.getElementById("hp");
    const hpFill = document.getElementById("hpFill");
    const hitBtn = document.getElementById("hitBtn");
    const cooldownFill = document.getElementById("cooldownFill");
    const critMessage = document.getElementById("critMessage");
    const enemyIcon = document.getElementById("enemyIcon");

    const cooldown = 2000; // 2 seconds
    let onCooldown = false;

    const hitSound = new Audio("hit.mp3");
    const critSound = new Audio("crit.mp3");
    const deathSound = new Audio("death.mp3");
    const cooldownSound = new Audio("ready.mp3");
    const bgMusic = new Audio("bgmusic.mp3");
    bgMusic.loop = true;

    function getRandomDamage(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function getAttackDamage(base, critChance = 0.2, critMultiplier = 2) {
        if (Math.random() < critChance) {
            showCrit();
            critSound.play();
            return base * critMultiplier;
        }
        return base;
    }

    function showCrit() {
        critMessage.textContent = "CRITICAL HIT!";
        critMessage.style.opacity = 1;
        setTimeout(() => {
            critMessage.style.opacity = 0;
        }, 500);
    }

    function updateHpDisplay() {
        hpDisplay.textContent = `HP: ${hp}`;
        const percent = (hp / maxHp) * 100;
        hpFill.style.width = `${percent}%`;
    }

    function flashEnemy() {
        enemyIcon.style.filter = "brightness(2)";
        setTimeout(() => {
            enemyIcon.style.filter = "none";
        }, 150);
    }

    function takeDamage() {
        if (onCooldown || defeated) return;

        if (bgMusic.paused) {
            bgMusic.play();
        }

        flashEnemy();
        hitSound.play();

        let baseDamage = getRandomDamage(7, 12);
        let finalDamage = getAttackDamage(baseDamage);

        hp = Math.max(0, hp - finalDamage);
        updateHpDisplay();
        checkDefeat();

        onCooldown = true;
        hitBtn.disabled = true;

        let startTime = Date.now();

        function updateCooldown() {
            let elapsed = Date.now() - startTime;
            let progress = Math.min(elapsed / cooldown, 1);
            cooldownFill.style.width = `${progress * 100}%`;

            if (progress < 1) {
                requestAnimationFrame(updateCooldown);
            } else {
                onCooldown = false;
                hitBtn.disabled = false;
                cooldownFill.style.width = "0%";
                cooldownSound.play();
            }
        }

        updateCooldown();
    }

    hitBtn.addEventListener("click", () => takeDamage());
    document.addEventListener("keydown", (event) => {
        if (event.code === "Space" || event.code === "Enter") {
            event.preventDefault();
            if (!onCooldown) takeDamage();
        }
    });

    setInterval(() => {
        if (hp < maxHp && !defeated) {
            hp++;
            updateHpDisplay();
        }
    }, 500);

    updateHpDisplay();

    function checkDefeat() {
        if (hp <= 0 && !defeated) {
            hp = 0;
            updateHpDisplay();
            hitBtn.disabled = true;
            critMessage.textContent = "YOU WIN!";
            critMessage.style.opacity = 1;
            defeated = true;
            hpFill.style.background = "#555";
            bgMusic.pause();
            deathSound.play();
            enemyIcon.style.filter = "grayscale(100%)";
        }
    }
</script>
</body>
</html>
